# Command Injection Checker

A Python security analysis tool that scans Python source code for potential command injection vulnerabilities. This tool helps developers identify security risks in their code by detecting dangerous patterns in subprocess calls, system commands, and user input handling.

## Features

- **AST-based Analysis**: Uses Python's Abstract Syntax Tree for accurate code parsing
- **Multiple Severity Levels**: Categorizes findings as low, medium, high, or critical
- **Comprehensive Pattern Detection**: Identifies various types of command injection risks
- **Flexible Output**: Console output and JSON report generation
- **Recursive Directory Scanning**: Analyze entire projects or single files
- **Context-aware Reporting**: Shows code context around each finding
- **Shell Metacharacter Detection**: Identifies dangerous shell characters in strings

## Installation

### Requirements

- Python 3.6 or higher
- No external dependencies (uses only standard library)

### Setup

1. Download the `command_injection_checker.py` script
2. Make it executable (optional):
   ```bash
   chmod +x command_injection_checker.py
   ```

## Usage

### Basic Usage

Analyze a single Python file:
```bash
python command_injection_checker.py script.py
```

Analyze all Python files in a directory:
```bash
python command_injection_checker.py /path/to/project
```

Recursively analyze a directory and subdirectories:
```bash
python command_injection_checker.py /path/to/project --recursive
```

### Advanced Options

Filter by severity level:
```bash
python command_injection_checker.py script.py --severity high
```

Save results to JSON file:
```bash
python command_injection_checker.py script.py --output report.json
```

Combine options:
```bash
python command_injection_checker.py /path/to/project -r --severity medium --output security_report.json
```

Enable verbose logging:
```bash
python command_injection_checker.py script.py --verbose
```

### Command Line Arguments

| Argument | Description | Default |
|----------|-------------|---------|
| `target` | Python file or directory to analyze | Required |
| `-r, --recursive` | Recursively analyze subdirectories | False |
| `--severity` | Minimum severity level (low/medium/high/critical) | low |
| `-o, --output` | Save results to JSON file | None |
| `-v, --verbose` | Enable verbose logging | False |

## What It Detects

### Dangerous Functions
- `os.system()` - High risk
- `os.popen()` - High risk  
- `subprocess.*` functions - Medium to high risk
- `eval()` and `exec()` - Critical risk
- Legacy `commands` module functions - High risk

### Vulnerability Patterns
- **User Input in Commands**: Detects when user input is passed to system commands
- **String Formatting**: Identifies string formatting operations in command arguments
- **Shell Metacharacters**: Finds dangerous shell characters (`;&|$` etc.)
- **Shell=True Usage**: Flags subprocess calls with `shell=True`
- **String Concatenation**: Detects string concatenation in command construction

### Severity Levels

- **Critical**: `eval()`, `exec()` usage, or dangerous functions with clear user input
- **High**: `os.system()`, `os.popen()`, or subprocess with `shell=True`  
- **Medium**: `subprocess` functions, shell metacharacters
- **Low**: General suspicious patterns

## Example Output

```
============================================================
COMMAND INJECTION VULNERABILITY ANALYSIS
============================================================

File: example.py
----------------------------------------

[HIGH] Potentially unsafe use of os.system with user input or variables
Location: Line 15, Column 4
Type: dangerous_call_with_input
Recommendation: Validate and sanitize input before passing to os.system. Consider using subprocess with shell=False and argument lists.

Context:
    13: def run_command(user_input):
    14:     # Dangerous: user input directly in system call
>>> 15:     os.system(f"ls {user_input}")
    16:     return True
    17: 

[MEDIUM] String contains shell metacharacters: [;&|`$]
Location: Line 20, Column 15
Type: shell_metacharacters
Recommendation: Avoid shell metacharacters in commands. Use parameterized commands or proper escaping.

============================================================
Total issues found: 2
============================================================
```

## JSON Output Format

When using `--output`, the tool generates a JSON report:

```json
{
  "example.py": [
    {
      "type": "dangerous_call_with_input",
      "severity": "high",
      "description": "Potentially unsafe use of os.system with user input or variables",
      "line": 15,
      "column": 4,
      "context": "    13: def run_command(user_input):\n    14:     # Dangerous: user input directly in system call\n>>> 15:     os.system(f\"ls {user_input}\")\n    16:     return True",
      "recommendation": "Validate and sanitize input before passing to os.system. Consider using subprocess with shell=False and argument lists."
    }
  ]
}
```

## Exit Codes

- `0`: No vulnerabilities found
- `1`: Non-critical vulnerabilities found
- `2`: Critical vulnerabilities found
- `130`: Interrupted by user (Ctrl+C)

## Security Best Practices

### Recommendations for Fixing Issues

1. **Use subprocess with argument lists**:
   ```python
   # Bad
   os.system(f"ls {user_input}")
   
   # Good
   subprocess.run(["ls", user_input], check=True)
   ```

2. **Validate and sanitize input**:
   ```python
   import shlex
   
   # Properly escape shell arguments
   safe_arg = shlex.quote(user_input)
   ```

3. **Avoid shell=True**:
   ```python
   # Bad
   subprocess.run(f"ls {filename}", shell=True)
   
   # Good
   subprocess.run(["ls", filename])
   ```

4. **Use allowlists for user input**:
   ```python
   ALLOWED_COMMANDS = ["ls", "cat", "grep"]
   if command in ALLOWED_COMMANDS:
       subprocess.run([command, filename])
   ```

## Limitations

- **Static Analysis Only**: Cannot detect runtime-generated commands
- **False Positives**: May flag legitimate uses of system functions
- **Python Only**: Only analyzes Python source code
- **AST Parsing**: Cannot analyze syntactically invalid Python files

## Ethical Use and Warnings

⚠️ **Important**: This tool is designed for defensive security purposes only.

### Acceptable Use
- Code security reviews
- Vulnerability assessment of your own applications
- Educational purposes in secure environments
- Security auditing with proper authorization

### Prohibited Use
- Testing against systems you don't own or lack permission to test
- Malicious exploitation of discovered vulnerabilities
- Unauthorized security testing

### Legal Considerations
- Always obtain proper authorization before testing
- Respect applicable laws and regulations
- Follow responsible disclosure practices for vulnerabilities
- Use only on systems you own or have explicit permission to test

## Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Ensure code follows Python best practices
5. Submit a pull request

## License

MIT License

Copyright (c) 2024 Command Injection Checker

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

## Changelog

### Version 1.0.0
- Initial release
- AST-based analysis engine
- Multiple severity levels
- JSON and console output
- Recursive directory scanning
- Shell metacharacter detection

## Support

For questions, issues, or feature requests, please create an issue in the project repository.

---

*Remember: Security is everyone's responsibility. Use this tool as part of a comprehensive security strategy.*
